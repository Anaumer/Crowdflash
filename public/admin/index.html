<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Crowd Flash Admin – Control Panel</title>
    <meta name="description" content="Crowd Flash Admin Console – Control connected devices in real-time." />
    <link rel="stylesheet" href="admin.css" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="config.js"></script>
    <script>
        if (!localStorage.getItem('crowdflash_token')) {
            window.location.href = 'login.html';
        }
    </script>
</head>

<body>

    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <div class="sidebar-logo-dot"></div>
            <h1>CROWD FLASH <small style="font-size: 0.6em; opacity: 0.5; font-weight: 300; margin-left: 0.25rem;">by
                    aroma</small></h1>
        </div>

        <nav class="sidebar-nav">
            <a class="nav-item active" href="#">
                <span class="material-symbols-outlined">dashboard</span>
                <span>Dashboard</span>
            </a>
            <a class="nav-item" href="#">
                <span class="material-symbols-outlined">live_tv</span>
                <span>Live Show</span>
            </a>
            <a class="nav-item" href="#">
                <span class="material-symbols-outlined">devices</span>
                <span>Devices</span>
            </a>
            <a class="nav-item" href="#">
                <span class="material-symbols-outlined">analytics</span>
                <span>Analytics</span>
            </a>
            <a class="nav-item" href="#">
                <span class="material-symbols-outlined">settings</span>
                <span>Settings</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="sidebar-user">
                <div class="sidebar-user-avatar"></div>
                <div>
                    <div class="sidebar-user-name">Lead Admin</div>
                    <div class="sidebar-user-role">Main Console</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- ===== MAIN AREA ===== -->
    <main class="main-area">

        <!-- Left: Metrics Panel -->
        <section class="metrics-panel">
            <h2 class="section-title">Core Metrics</h2>

            <!-- Active Users -->
            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-label">Active Users</span>
                    <span class="metric-badge positive" id="users-change">+0%</span>
                </div>
                <div class="metric-value" id="active-users">0</div>
                <div class="sparkline-container">
                    <svg preserveAspectRatio="none" viewBox="0 0 100 40">
                        <path id="sparkline-path" d="M0,35 Q10,32 20,34 T40,25 T60,28 T80,15 T100,20" fill="none"
                            stroke="#f9f906" stroke-width="2" vector-effect="non-scaling-stroke" />
                    </svg>
                </div>
            </div>

            <!-- Stability -->
            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-label">Stability</span>
                    <span class="material-symbols-outlined"
                        style="color: var(--primary); font-size: 0.875rem;">wifi</span>
                </div>
                <div class="metric-value" style="font-size: 1.875rem;" id="stability">0%</div>
                <div class="stability-bars">
                    <div class="stability-bar" id="stab-1"></div>
                    <div class="stability-bar" id="stab-2"></div>
                    <div class="stability-bar" id="stab-3"></div>
                    <div class="stability-bar" id="stab-4"></div>
                    <div class="stability-bar dim" id="stab-5"></div>
                </div>
            </div>

            <!-- Battery -->
            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-label">Avg Battery</span>
                    <span class="material-symbols-outlined"
                        style="color: var(--text-muted); font-size: 0.875rem;">battery_charging_full</span>
                </div>
                <div class="metric-value" style="font-size: 1.875rem;" id="avg-battery">0%</div>
                <p style="font-size: 0.625rem; color: var(--text-muted); margin-top: 0.5rem;">Critical threshold: 15%
                </p>
            </div>
        </section>

        <!-- Center: Console -->
        <section class="console-panel">
            <!-- Console Header -->
            <div class="console-header">
                <div class="console-title">
                    <span>Main Console</span>
                    <div class="console-divider"></div>
                    <div class="console-status">
                        <span class="status-dot" id="system-dot"></span>
                        <span class="status-text" id="system-status">Venue System: ONLINE</span>
                    </div>
                </div>
                <button class="btn-emergency" id="btn-emergency">EMERGENCY STOP</button>
            </div>

            <!-- Master Trigger -->
            <div class="trigger-area">
                <div class="trigger-wrapper">
                    <div class="trigger-ring-outer"></div>
                    <div class="trigger-ring-inner"></div>
                    <button class="trigger-btn" id="master-trigger">
                        <div class="trigger-overlay"></div>
                        <span class="material-symbols-outlined">bolt</span>
                        <div class="trigger-label">MASTER<br />TRIGGER</div>
                    </button>
                </div>
                <p class="trigger-hint">Holding triggers global synchronized flash</p>
            </div>

            <!-- Controls Bar -->
            <div class="controls-bar">
                <div class="controls-grid">

                    <!-- BPM Sync -->
                    <div class="control-group">
                        <label class="control-label">BPM Sync</label>
                        <div class="bpm-control">
                            <div class="bpm-input-wrapper">
                                <button class="bpm-btn" id="bpm-minus">
                                    <span class="material-symbols-outlined" style="font-size: 0.875rem;">remove</span>
                                </button>
                                <input class="bpm-input" type="number" value="128" id="bpm-value" />
                                <button class="bpm-btn" id="bpm-plus">
                                    <span class="material-symbols-outlined" style="font-size: 0.875rem;">add</span>
                                </button>
                            </div>
                            <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                <button class="btn-tap" id="btn-tap" style="flex: 1;">Tap</button>
                                <button class="btn-tap" id="btn-bpm-flash"
                                    style="flex: 1; background: var(--primary); color: white; border: none;">
                                    <span class="material-symbols-outlined"
                                        style="font-size: 1rem; vertical-align: middle;">flash_on</span> Auto
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Countdown -->
                    <div class="control-group">
                        <label class="control-label">Countdown</label>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span style="font-size: 0.75rem; color: var(--text-muted);">Duration</span>
                            <span id="countdown-display"
                                style="font-size: 0.75rem; font-family: monospace; color: var(--primary);">10s</span>
                        </div>
                        <input class="range-slider" type="range" id="countdown-slider" min="5" max="60" value="10"
                            step="5">
                        <button class="btn-emergency" id="btn-start-countdown"
                            style="margin-top: 0.75rem; width: 100%; background: var(--bg-card); border: 1px solid var(--primary); color: var(--primary);">
                            START COUNTDOWN
                        </button>
                    </div>

                    <!-- Strobe Rate -->
                    <div class="control-group">
                        <div class="strobe-header">
                            <label class="control-label">Strobe Rate</label>
                            <span class="strobe-value" id="strobe-display">0 Hz</span>
                        </div>
                        <div style="position: relative; padding: 0.5rem 0;">
                            <input class="range-slider" type="range" min="0" max="100" value="0" id="strobe-slider" />
                            <div class="range-labels">
                                <span>Steady</span>
                                <span>Fast</span>
                                <span>Insane</span>
                            </div>
                        </div>
                    </div>

                    <!-- Flash Pattern -->
                    <div class="control-group">
                        <label class="control-label">Flash Pattern</label>
                        <div class="pattern-grid">
                            <button class="pattern-btn" data-pattern="SHORT">Short</button>
                            <button class="pattern-btn" data-pattern="PULSE">Pulse</button>
                            <button class="pattern-btn" data-pattern="LONG">Long</button>
                            <button class="pattern-btn" data-pattern="WAVE">Wave</button>
                        </div>
                    </div>

                    <!-- Audio Sync (Full Width) -->
                    <div class="control-group" style="grid-column: 1 / -1;">
                        <label class="control-label">Audio Sync (MP3)</label>
                        <div
                            style="display: flex; gap: 1rem; align-items: flex-start; background: rgba(0,0,0,0.2); padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border);">
                            <div style="flex: 1;">
                                <input type="file" id="audio-file" accept="audio/mp3,audio/wav"
                                    style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem; width: 100%;">
                                <audio id="audio-player" controls
                                    style="width: 100%; height: 32px; display: none;"></audio>
                            </div>
                            <div style="flex: 1; display: flex; flex-direction: column; gap: 0.5rem;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="font-size: 0.75rem; color: var(--text-muted);">Sensitivity</span>
                                    <span id="threshold-display"
                                        style="font-size: 0.75rem; color: var(--text-primary);">50%</span>
                                </div>
                                <input class="range-slider" type="range" id="audio-threshold" min="0" max="100"
                                    value="50">
                            </div>
                            <div
                                style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.25rem;">
                                <div id="beat-indicator"
                                    style="width: 24px; height: 24px; background: #334155; border-radius: 50%; transition: background 0.05s;">
                                </div>
                                <span style="font-size: 0.625rem; color: var(--text-muted);">BEAT</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Center: Devices Panel (Hidden by default) -->
        <section class="devices-panel" style="display: none;">
            <div class="panel-header">
                <h2 class="section-title">Connected Devices</h2>
                <div class="device-controls">
                    <input type="text" id="device-search" placeholder="Search ID or IP..." class="search-input">
                    <button class="btn-secondary small" id="btn-refresh-devices">
                        <span class="material-symbols-outlined">refresh</span>
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-sort="id">ID <span class="sort-icon"></span></th>
                            <th data-sort="time">Duration <span class="sort-icon"></span></th>
                            <th data-sort="batt">Batt <span class="sort-icon"></span></th>
                            <th>IP / Location</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="device-list-body">
                        <!-- Rows generated via JS -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Right: Venue & Log -->
        <section class="right-panel">
            <!-- Venue Distribution -->
            <div class="venue-section">
                <h2 class="section-title" style="margin-bottom: 1rem;">Venue Distribution</h2>
                <div class="venue-map" id="venue-map">
                    <div class="venue-grid"></div>
                    <!-- Dots will be generated dynamically -->
                    <div class="venue-label">Floor 1 • Main Stage</div>
                </div>
            </div>

            <!-- Live Event Log -->
            <div class="log-section">
                <h2 class="section-title" style="margin-bottom: 1rem;">Live Event Log</h2>
                <div class="log-container" id="event-log">
                    <!-- Log entries will be added dynamically -->
                </div>
            </div>
        </section>

    </main>

    <script src="admin.js"></script>
</body>

</html>