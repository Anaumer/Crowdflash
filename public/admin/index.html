<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Starcatcher – Admin Console</title>
    <meta name="description" content="Crowd Flash Admin Console – Control connected devices in real-time." />
    <link rel="stylesheet" href="admin.css" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="config.js"></script>
    <script>
        if (!localStorage.getItem('crowdflash_token')) {
            window.location.href = 'login.html';
        }
    </script>
</head>

<body>

    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <div class="sidebar-brand">Starcatcher</div>
        </div>

        <nav class="sidebar-nav">
            <a href="#" class="nav-item active"><span class="material-symbols-outlined">dashboard</span> Overview</a>
            <a href="#" class="nav-item"><span class="material-symbols-outlined">confirmation_number</span> Live
                Show</a>
            <a href="#" class="nav-item"><span class="material-symbols-outlined">devices</span> Devices</a>
            <a href="#" class="nav-item"><span class="material-symbols-outlined">videocam</span> Videos</a>
            <a href="#" class="nav-item"><span class="material-symbols-outlined">analytics</span> Analytics</a>
        </nav>

        <div class="sidebar-footer">
            <div class="sidebar-user">
                <div class="sidebar-user-avatar"></div>
                <div style="flex: 1;">
                    <div class="sidebar-user-name">Lead Admin</div>
                    <div class="sidebar-user-role">Main Console &bull; v1.1.2</div>
                </div>
                <button id="btn-logout" onclick="window.crowdflashLogout && window.crowdflashLogout()"
                    style="background: none; border: none; color: var(--text-muted); cursor: pointer;" title="Logout">
                    <span class="material-symbols-outlined">logout</span>
                </button>
            </div>
        </div>
    </aside>

    <!-- ===== MAIN AREA ===== -->
    <main class="main-area" style="flex-direction: column; padding: 2rem; overflow-y: auto;">

        <!-- Top Bar -->
        <header class="top-bar"
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-shrink: 0;">
            <h2 id="page-title" style="font-size: 1.5rem; font-weight: 700; color: white;">Overview</h2>
            <div class="system-status"
                style="display: flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.05); padding: 0.5rem 1rem; border-radius: 99px; border: 1px solid var(--border);">
                <div class="status-dot" id="system-dot"></div>
                <span id="system-status"
                    style="font-size: 0.8rem; font-weight: 600; color: var(--text-secondary);">Venue System:
                    CHECKING...</span>
            </div>
        </header>

        <!-- PANEL: OVERVIEW (DASHBOARD) -->
        <div id="panel-overview" class="panel-view active">
            <div class="grid-dashboard">
                <!-- Metrics Row -->
                <div class="card metric-card">
                    <h3>Active Users</h3>
                    <div class="metric-value" id="active-users">0</div>
                    <div class="metric-badge" id="users-change">+0%</div>
                    <svg class="sparkline" height="40" width="100">
                        <path d="M0,40 L100,40" fill="none" id="sparkline-path" stroke="var(--primary)"
                            stroke-width="2">
                        </path>
                    </svg>
                </div>
                <div class="card metric-card">
                    <h3>Network Stability</h3>
                    <div class="metric-value" id="stability">0.0%</div>
                    <div class="stability-bars">
                        <div class="stability-bar" id="stab-1"></div>
                        <div class="stability-bar" id="stab-2"></div>
                        <div class="stability-bar" id="stab-3"></div>
                        <div class="stability-bar" id="stab-4"></div>
                        <div class="stability-bar" id="stab-5"></div>
                    </div>
                </div>
                <div class="card metric-card">
                    <h3>Avg Battery</h3>
                    <div class="metric-value" id="avg-battery">0%</div>
                    <span style="font-size: 0.75rem; color: var(--text-muted);">across all devices</span>
                </div>

                <!-- Venue Map (Large) -->
                <div class="card venue-map-card" style="grid-column: 1 / -1; min-height: 400px;">
                    <div class="card-header"
                        style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <h3>Venue Distribution</h3>
                        <div class="venue-legend" style="display: flex; gap: 1rem;">
                            <span class="legend-item"
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; color: var(--text-muted);"><span
                                    class="dot"
                                    style="width:8px; height:8px; border-radius:50%; background:var(--primary)"></span>Active</span>
                            <span class="legend-item"
                                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; color: var(--text-muted);"><span
                                    class="dot"
                                    style="width:8px; height:8px; border-radius:50%; background:var(--text-muted)"></span>Idle</span>
                        </div>
                    </div>
                    <div class="venue-map" id="venue-map"
                        style="flex: 1; background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius); position: relative; min-height: 300px;">
                        <!-- Dots injected by JS -->
                        <div class="stage-marker"
                            style="position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.1); padding: 0.25rem 1rem; border-radius: 100px; font-size: 0.75rem; font-weight: 600; border: 1px solid rgba(255,255,255,0.2);">
                            STAGE</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PANEL: LIVE CONSOLE -->
        <div id="panel-live" class="panel-view" style="display: none;">
            <div class="grid-console">
                <!-- Master Trigger -->
                <div class="card trigger-card"
                    style="display: flex; align-items: center; justify-content: center; min-height: 400px; padding: 2rem;">
                    <div class="trigger-wrapper">
                        <div class="trigger-ring-outer"></div>
                        <div class="trigger-ring-inner"></div>
                        <button class="trigger-btn" id="master-trigger">
                            <div class="trigger-overlay"></div>
                            <span class="material-symbols-outlined">bolt</span>
                            <div class="trigger-label">MASTER<br />TRIGGER</div>
                        </button>
                    </div>
                    <p class="trigger-hint"
                        style="margin-top: 2rem; opacity: 0.5; font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase;">
                        Holding triggers global flash</p>

                    <button class="btn-emergency" id="btn-emergency"
                        style="position: absolute; bottom: 1.5rem; right: 1.5rem;">EMERGENCY STOP</button>
                </div>

                <!-- Pattern Control -->
                <div class="card control-card">
                    <h3>Flash Patterns</h3>
                    <div class="grid-patterns">
                        <button class="pattern-btn" data-pattern="SHORT">Short</button>
                        <button class="pattern-btn" data-pattern="PULSE">Pulse</button>
                        <button class="pattern-btn" data-pattern="LONG">Long</button>
                        <button class="pattern-btn" data-pattern="WAVE">Wave</button>
                    </div>

                    <div style="margin-top: 1.5rem;">
                        <h3 style="margin-bottom:0.5rem; font-size: 0.8rem; color: var(--text-muted);">Strobe Rate <span
                                id="strobe-display" style="float:right; color:var(--primary)">0 Hz</span></h3>
                        <input type="range" min="0" max="100" value="0" class="slider" id="strobe-slider">
                    </div>
                </div>

                <!-- BPM & Sync -->
                <div class="card control-card">
                    <h3>BPM Sync</h3>
                    <div class="bpm-display">
                        <button class="btn-icon" id="bpm-minus"><span
                                class="material-symbols-outlined">remove</span></button>
                        <input type="number" id="bpm-value" value="128">
                        <button class="btn-icon" id="bpm-plus"><span
                                class="material-symbols-outlined">add</span></button>
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button class="btn-secondary" id="btn-tap"
                            style="flex: 1; padding: 0.75rem; border-radius: var(--radius); border: 1px solid var(--border); background: var(--surface-light); color: white; cursor: pointer;">TAP</button>
                        <button class="btn-primary" id="btn-bpm-flash"
                            style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 0.5rem; background: var(--surface-light); border: 1px solid var(--border); color: white; border-radius: var(--radius); cursor: pointer;">
                            <span class="material-symbols-outlined" style="font-size: 1rem;">flash_on</span> Auto
                        </button>
                    </div>
                </div>

                <!-- Countdown -->
                <div class="card control-card">
                    <h3>Countdown</h3>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="font-size: 0.875rem;">Duration</span>
                        <span id="countdown-display"
                            style="font-size: 0.875rem; color: var(--primary); font-weight: bold;">10s</span>
                    </div>
                    <input type="range" min="3" max="60" value="10" class="slider" id="countdown-slider">
                    <button class="btn-primary-outline" id="btn-start-countdown"
                        style="margin-top: 1rem; width: 100%; padding: 0.75rem; border: 1px solid var(--primary); background: transparent; color: var(--primary); border-radius: var(--radius); cursor: pointer; font-weight: 700;">START
                        COUNTDOWN</button>
                </div>

                <!-- Audio Sync -->
                <div class="card control-card">
                    <h3>Audio Sync (MP3)</h3>

                    <div class="file-upload-wrapper">
                        <label for="audio-file" class="btn-file">
                            <span class="material-symbols-outlined">upload_file</span>
                            Datei auswählen
                        </label>
                        <span id="file-name" class="file-name">Keine Datei ausgewählt</span>
                        <input type="file" id="audio-file" accept="audio/*">
                    </div>

                    <audio id="audio-player" controls style="width: 100%; margin-top: 1rem; display: none;"></audio>

                    <div style="margin-top: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span style="font-size: 0.75rem; color: var(--text-muted);">Sensitivity</span>
                            <span id="threshold-display" style="font-size: 0.75rem;">50%</span>
                        </div>
                        <input type="range" min="1" max="100" value="50" class="slider" id="audio-threshold">
                    </div>

                    <div id="beat-indicator"
                        style="width: 1rem; height: 1rem; border-radius: 50%; background: var(--surface-light); margin-top: 1rem; transition: transform 0.05s; align-self: center;">
                    </div>
                </div>


            </div>
        </div>

        <!-- PANEL: DEVICES -->
        <div id="panel-devices" class="panel-view" style="display: none;">
            <div class="card">
                <div class="card-header"
                    style="display: flex; justify-content: space-between; margin-bottom: 1rem; align-items: center;">
                    <h3>Connected Devices</h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="device-search" placeholder="Search ID or IP..."
                            style="padding: 0.5rem; border-radius: var(--radius); border: 1px solid var(--border); background: var(--bg-dark); color: var(--text-primary);">
                        <button id="btn-refresh-devices" class="btn-icon-square">
                            <span class="material-symbols-outlined">refresh</span>
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table style="width: 100%; border-collapse: collapse; text-align: left; font-size: 0.875rem;">
                        <thead>
                            <tr style="border-bottom: 1px solid var(--border); color: var(--text-muted);">
                                <th style="padding: 0.75rem;" data-sort="id">ID</th>
                                <th style="padding: 0.75rem;" data-sort="time">Duration</th>
                                <th style="padding: 0.75rem;" data-sort="batt">Batt</th>
                                <th style="padding: 0.75rem;">IP / Location</th>
                                <th style="padding: 0.75rem;">Action</th>
                            </tr>
                        </thead>
                        <tbody id="device-list-body">
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PANEL: VIDEOS -->
        <div id="panel-videos" class="panel-view" style="display: none;">
            <div class="card" style="min-height: 80vh;">
                <div class="card-header"
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3>Crowd Videos</h3>
                    <button id="btn-refresh-videos" class="btn-icon-square">
                        <span class="material-symbols-outlined">refresh</span>
                    </button>
                </div>
                <div class="video-grid" id="video-gallery"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem;">
                    <!-- Videos injected via JS -->
                    <div style="color: var(--text-muted); grid-column: 1/-1; text-align: center; padding: 2rem;">Loading
                        gallery...</div>
                </div>
            </div>
        </div>

        <!-- PANEL: ANALYTICS -->
        <div id="panel-analytics" class="panel-view" style="display: none; height: 100%;">
            <div class="card" style="height: 100%;">
                <h3>Live Event Log</h3>
                <div class="event-log" id="event-log">
                    <!-- Logs -->
                </div>
            </div>
        </div>

    </main>

    <script src="admin.js?v=1.1.2"></script>
</body>

</html>